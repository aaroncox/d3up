<?
	$profile = Epic_Auth::getInstance()->getProfile();
	$this->headTitle($this->record->name); 
	$this->headTitle(ucwords(str_replace("-", " ", $this->record->class))); 
	$this->myBuild = $myBuild = false;
	if($profile && $this->record->_createdBy && $profile->createReference() == $this->record->_createdBy->createReference()) {
		$this->myBuild = $myBuild = true;
	}	
?>
<div id="build">
  <?= $this->render("./record/build/header.phtml") ?>
	<div id="character" class="ui-helper-clearfix" data-id="<?= $this->record->id ?>" data-class="<?= $this->record->class ?>" <? if($myBuild) { echo "data-owner='true'"; } ?>>
	  <style type="text/css" media="screen">
	   #character {
	     border-top: 1px solid #333;
	   }
	   ul#tabs {
	     float: left;
	     width: 150px;
	     margin: 0;
	     padding: 5px;
	     list-style: none;
	     background: #111;
	     border: 1px solid #333;
	     border-top: 0;
	   }
	   ul#tabs li {
	     margin: 1px;
	   }
	   ul#tabs li.divider {
	     padding: 10px 5px 0;
	     font-weight: bold;
	     text-transform: uppercase;
	   }
	   ul#tabs li:first-child {
	     margin: 1px;
	     padding-top: 0;
	   }
	   div#tabs-render {
	     float: left;
	     width: 494px;
	     border: 0;
	     padding: 0;
	   }
	   div#tabs-render .content-page {
	     border: 0;
	   }
	   div#tabs-render.content-page .form, 
	   div#tabs-render.content-page .page {
	     padding: 2px;
       margin: 10px 5px;
	   }
	   div#tabs-render.content-page .form {
  	   padding: 20px 50px;	     
	   } 
	   div#tabs-render > div {
	   }
	   div#tabs-render > div > h5 {
        margin: 0;
        font-size: 1em;
        line-height: 1.4em;
        font-weight: bold;
        border-right: 0;
        padding: 5px 10px;
        text-transform: uppercase;
        color: #B18135;
        background: rgb(17,17,17); /* Old browsers */
        background: -moz-linear-gradient(top, rgba(17,17,17,1) 0%, rgba(34,34,34,1) 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(17,17,17,1)), color-stop(100%,rgba(34,34,34,1))); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* IE10+ */
        background: linear-gradient(to bottom, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#111111', endColorstr='#222222',GradientType=0 ); /* IE6-9 */
	   }
	   div#tabs-render > div > a.button {
       margin: 10px;
	   }
	   div#tabs-render > div:first-child {
	     display: block;
	   }
	   div#statistics {
	     float: right;
	     width: 310px;
	     background: #111;
	     border: 1px solid #333;	 
	     border-top: 0;
	     padding-bottom: 2px;    
	     margin: 0 2px 0 0;
	   }
	  </style>
	  <? if($this->resync): ?>
	  <div class="notifications">
      <strong>Notice</strong>: Your character has been synchronized with the Battle.net Profile specified.
	  </div>
	  <? endif ?>
    <ul id="tabs">
      <li class='divider'>Character</li>
      <li><a data-tab="#gear" class="button current">Gear</a></a></li>
      <li><a data-tab="#skills" class="button">Skills</a></li>
      <li><a data-tab="#passives" class="button">Passives</a></li>
      <li><a data-tab="#buffs" class="button">Buffs</a></li>
      <? if($this->myBuild): ?>
      <li><a data-tab="#edit" class="button">Edit</a></li>
      <? endif ?>
      <li class='divider'>Tools</li>
      <? if(!$this->record->_createdBy->id || ($profile && $profile->id === $this->record->_createdBy->id)): ?>
      <li><a data-tab="#sync" class="button">Battle.net Sync</a></li>
      <? endif ?>
      <? if($this->myBuild): ?>
      <li><a class="button" href="/user/items">My Items</a></li>
      <? endif ?>
      <li><a data-tab="#suggestions" class="button">Suggestions</a></li>
      <li><a data-tab="#share" class="button">Share</a></li>
    </ul>
    <div id="tabs-render" class="content-page">
      <div id="gear"><?= $this->render("./record/build/gear.phtml") ?></div>
      <div id="skills"><?= $this->render("./record/build/skills.phtml") ?></div>
      <div id="passives"><?= $this->render("./record/build/passives.phtml") ?></div>
      <div id="buffs"><?= $this->render("./record/build/buffs.phtml") ?></div>
      <? if($this->myBuild): ?>
      <div id="edit"><?= $this->render("./record/build/edit.phtml") ?></div>
      <? endif ?>
      <? if(!$this->record->_createdBy->id || ($profile && $profile->id === $this->record->_createdBy->id)): ?>
      <div id="sync"><?= $this->render("./record/build/sync.phtml") ?></div>
      <? endif ?>
      <div id="suggestions"><?= $this->render("./record/build/suggestions.phtml") ?></div>
      <div id="share"><?= $this->render("./record/build/share.phtml") ?></div>
    </div>
    <div id="statistics" class="inline-flow">
      <?= $this->render("record/build/statistics.phtml") ?>
    </div>
  </div>
  <div id="gear-change" title="Select an Item">
		<p>Listed below are all of the items you've created that would fit into this equipment slot.</p>
		<p>Please choose which item you'd like to equip.</p>
		<fieldset>
			<select name="available" id="available-gear">
			</select>
		</fieldset>
		</form>
	</div>
	<script type="text/javascript" charset="utf-8">
	 	<? if($this->alreadyVoted): ?>
 		var voted = '<?= $this->alreadyVoted ?>';
 		<? else: ?>
 		var voted = false;
 		<? endif ?>
 		<? if($profile): ?>
 		var isLoggedIn = true;
 		<? else: ?>
 		var isLoggedIn = false;
 		<? endif ?>
 	</script>
	</script>
	<script type="text/javascript" src="/js/unmin/compare.js"></script>	
	<script type="text/javascript" src="/js/unmin/buildv2.js"></script>	
  <script type="text/javascript">
    // ------------------------------
    // Legacy Code, Needs Revamped Eventually
    // ------------------------------
		var bonusCounter = {};
		$(".equipped a[json]").each(function() {
			var json = $(this).data("json");
			if(json.set) {
				if(!bonusCounter[json.set]) {
					bonusCounter[json.set] = 0;
				}
				bonusCounter[json.set]++;
			}
		});
		$(".equipped a[json]").each(function() {
			var json = $(this).data("json");
			if(json.set) {
				$(this).attr("data-set-count", bonusCounter[json.set]);
			}
		});
  </script>
	<script type="text/javascript">
	  $(function() {
	    // ------------------------------
      // BuildV2 Scripts for This Page
      // ------------------------------
      var skills = {
            actives: <?= json_encode(($this->record->actives) ? $this->record->actives->export() : array()); ?>,
            passives: <?= json_encode(($this->record->passives) ? $this->record->passives->export() : array()); ?>
          },
          gearSlots = $("#build-gear .equipped"),
          gear = gearSlots.find("a[data-json]"),
          meta = {
            level: '<?= $this->record->level ?>',
            paragon: '<?= $this->record->paragon ?>',
            heroClass: '<?= $this->record->class ?>'
          },
          build = new d3up.Build({
            gear: gear, 
            skills: skills,
            meta: meta
          }),
          buildCompare = new d3up.Build({
            gear: gear, 
            skills: skills,
            meta: meta
          }),
          buildSimulate = new d3up.Build({
            gear: gear, 
            skills: skills,
            meta: meta
          }),
          buildEmpty = new d3up.Build, 
          compare = new d3up.Compare;
      buildCompare.run();
      // Store these so that BuildUI.js can get to em
      d3up.builds = {
        build: build,
        compare: buildCompare,
        simulate: buildSimulate
      };
      d3up.compare = compare;
      // Render build to Statistics Panels
      build.renderTo($("#statistics"));
      // Render build to a few of the Gear tabs
      build.renderTo($("#gear"));
      // Render the Skills and Data to the Header
      build.renderSkillsTo($("#build-header"));
      // Render the Skills into the Skills Tab
      build.renderSkillsTo($("#skills"));
      build.renderSkillsTo($("#passives"));
      build.renderSkillsTo($("#buffs"));
	  });
  </script>
  <script type="text/javascript" src="/js/unmin/buildui.js"></script>	
	
</div>