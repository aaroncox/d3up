<?
	$profile = Epic_Auth::getInstance()->getProfile();
	$this->headTitle($this->record->name); 
	$this->headTitle(ucwords(str_replace("-", " ", $this->record->class))); 
	$this->myBuild = $myBuild = false;
	if($profile && $this->record->_createdBy && $profile->createReference() == $this->record->_createdBy->createReference()) {
		$this->myBuild = $myBuild = true;
	}	
?>
<script type="text/javascript">
<? if($this->record->passives && $this->record->passives != "null" && count($this->record->passives)): ?>
var activePassives = <?= json_encode($this->record->passives->export()); ?>;
<? else: ?>
var activePassives = [];
<? endif; ?>
<? if($this->record->actives && $this->record->actives != "null" && count($this->record->actives)): ?>
var activeActives = <?= json_encode($this->record->actives->export()); ?>;
<? else: ?>
var activeActives = [];
<? endif; ?>
</script>
<div id="build" class="content-page">
  <?= $this->render("./record/build/header.phtml") ?>
	<div id="character" class="ui-helper-clearfix" data-class="<?= $this->record->class ?>" <? if($myBuild) { echo "data-owner='true'"; } ?>>
	  <style type="text/css" media="screen">
	   ul#tabs {
	     width: 150px;
	     margin: 0;
	     padding: 5px;
	     list-style: none;
	     background: #111;
	     border: 1px solid #333;
	   }
	   ul#tabs li {
	     margin: 1px;
	   }
	   ul#tabs li.divider {
	     padding: 10px 5px 0;
	     font-weight: bold;
	     text-transform: uppercase;
	   }
	   div#tabs-render {
	     width: 440px;
	     background: #111;
	     border: 1px solid #333;
	   }
	   div#tabs-render > div {
	     margin: 1px;
	   }
	   div#tabs-render > div > h5 {
        margin: 1px;
        line-height: 1em;
        border: 1px solid #333;
        padding: 5px 10px;
        text-transform: uppercase;
        color: #888;
        font-weight: normal;
        background: rgb(17,17,17); /* Old browsers */
        background: -moz-linear-gradient(top, rgba(17,17,17,1) 0%, rgba(34,34,34,1) 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(17,17,17,1)), color-stop(100%,rgba(34,34,34,1))); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* IE10+ */
        background: linear-gradient(to bottom, rgba(17,17,17,1) 0%,rgba(34,34,34,1) 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#111111', endColorstr='#222222',GradientType=0 ); /* IE6-9 */
	   }
	   div#tabs-render > div:first-child {
	     display: block;
	   }
	   div#statistics {
	     float: right;
	     width: 350px;
	     background: #111;
	     border: 1px solid #333;	     
	   }
	  </style>
    <ul id="tabs" class="inline-flow">
      <li class='divider'>Character</li>
      <li><a data-tab="#gear" class="button current">Gear</a></a></li>
      <li><a data-tab="#skills" class="button">Skills</a></li>
      <li><a data-tab="#passives" class="button">Passives</a></li>
      <li><a data-tab="#buffs" class="button">Buffs</a></li>
      <li><a data-tab="#edit" class="button">Edit</a></li>
      <li class='divider'>Tools</li>
      <li><a data-tab="#sync" class="button">Battle.net Sync</a></li>
      <li><a data-tab="#simulate" class="button">Simulate</a></li>
      <li><a data-tab="#compare" class="button">Compare</a></li>
      <li><a data-tab="#suggestions" class="button">Suggestions</a></li>
      <li><a data-tab="#share" class="button">Share</a></li>
    </ul>
    <div id="tabs-render" class="inline-flow">
      <div id="gear"><?= $this->render("./record/build/gear.phtml") ?></div>
      <div id="skills"><?= $this->render("./record/build/skills.phtml") ?></div>
      <div id="passives"><?= $this->render("./record/build/passives.phtml") ?></div>
      <div id="buffs">buffs</div>
      <div id="edit">edit</div>
      <div id="sync">sync</div>
      <div id="simulate">simulate</div>
      <div id="compare">compare</div>
      <div id="suggestions">suggest</div>
      <div id="share">Share</div>
    </div>
    <div id="statistics" class="inline-flow">
      <?= $this->render("record/build/statistics.phtml") ?>
    </div>
  </div>
	<script type="text/javascript">
		var bonusCounter = {};
		$(".equipped a").each(function() {
			var json = $(this).data("json");
			if(json.set) {
				if(!bonusCounter[json.set]) {
					bonusCounter[json.set] = 0;
				}
				bonusCounter[json.set]++;
			}
		});
		$(".equipped a").each(function() {
			var json = $(this).data("json");
			if(json.set) {
				$(this).attr("data-set-count", bonusCounter[json.set]);
			}
		});
		<? if($this->alreadyVoted): ?>
		var voted = '<?= $this->alreadyVoted ?>';
		<? else: ?>
		var voted = false;
		<? endif ?>
		<? if($profile): ?>
		var isLoggedIn = true;
		<? else: ?>
		var isLoggedIn = false;
		<? endif ?>

		// Sticky Statistics on the page
		// var $window = $(window),
		// 		$stickyEl = $('.sidebar');
		// 
		// var elTop = $stickyEl.offset().top;
		// $window.scroll(function() {
		// 	var windowTop = $window.scrollTop();
		// 	$stickyEl.toggleClass('sticky', windowTop > elTop);
		// });
	</script>
	<script type="text/javascript" src="/js/unmin/build.js?time=<?= time() ?>"></script>	
	<script type="text/javascript" charset="utf-8">
    $(function() {
      var controls = $('#tabs li a'),
          tabs = $("#tabs-render"),
          atabs = $("#tabs-render > div");
      atabs.hide();
      tabs.children(":first").show();
      controls.bind('click',function(){
        atabs.hide();
        controls.removeClass('current');
        tabs.find($(this).attr("data-tab")).show(); //show tab content that matches tab title index
        $(this).addClass('current'); //add current class on clicked tab title
      });
    });
  </script>
</div>