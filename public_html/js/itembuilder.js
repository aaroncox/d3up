var itemBuilder={item:{name:null,type:null,typeName:null,quality:null,attrs:{},stats:{},sockets:{},socketCount:0,setBonus:null},headerElements:[],footerElements:[],attrsSelected:[],nameInput:null,qualitySelect:null,attributeSelect:null,itemTypeSelect:null,socketSelect:null,preview:{},itemPreview:null,itemClass:{none:["amulet","ring","mojo","source","quiver"],armor:["belt","boots","bracers","chest","cloak","gloves","helm","pants","mighty-belt","shoulders","spirit-stone","voodoo-mask","wizard-hat"],weapon:["2h-mace","2h-axe","bow","diabo","crossbow","2h-mighty","polearm","staff","2h-sword","axe","ceremonial-knife","hand-crossbow","dagger","fist-weapon","mace","mighty-weapon","spear","sword","wand"],shield:["shield"]},qualityMap:["Unspecified","Inferior","Normal","Superior","Magic","Rare","Legendary","Set"],skillText:{strength:"+VVV Strength",intelligence:"+VVV Intelligence",vitality:"+VVV Vitality",dexterity:"+VVV Dexterity","resist-all":"+VVV Resistance to All Elements",armor:"+VVV Armor","plus-life":"+VVV% Life","life-regen":"Regenerates VVV Life per Second","cc-reduce":"Reduces the duration of control impairing effects by VVV%","elite-reduce":"Reduces damage from elites by VVV%","melee-reduce":"Reduces damage from melee attacks by VVV%","range-reduce":"Reduces damage from ranged attacks by VVV%","plus-block":"+VVV% Chance to Block","arcane-resist":"+VVV Arcane Resistance","cold-resist":"+VVV Cold Resistance","fire-resist":"+VVV Fire Resistance","lightning-resist":"+VVV Lightning Resistance","physical-resist":"+VVV Physical Resistance","poison-resist":"+VVV Poison Resistance",thorns:"Melee attackers take VVV damage per hit","attack-speed":"Attack speed increased by VVV%","plus-attack-speed":"Attack speed increased by VVV%","critical-hit":"Critical Hit Chance increased by VVV%","critical-hit-damage":"Critical Hit Damage increased by VVV%","plus-damage":"+VVV% Damage","min-damage":"+VVV Minimum Damage","max-damage":"+VVV Maximum Damage","life-steal":"VVV% of Damage Dealt is Converted to Life (Steal)","life-kill":"+VVV Life after each Kill","life-hit":"Each hit adds +VVV Life","minmax-damage":"+VVV Damage","arcane-damage":"+VVV Arcane Damage","cold-damage":"+VVV Cold Damage","fire-damage":"+VVV Fire Damage","holy-damage":"+VVV Holy Damage","lightning-damage":"+VVV Lightning Damage","poison-damage":"+VVV Poison Damage","plus-arcane-damage":"Adds +VVV% to Arcane Damage","plus-cold-damage":"Adds +VVV% to Cold Damage","plus-fire-damage":"Adds +VVV% to Fire Damage","plus-holy-damage":"Adds +VVV% to Holy Damage","plus-lightning-damage":"Adds +VVV% to Lightning Damage","plus-poison-damage":"Adds +VVV% to Poison Damage","elite-damage":"Increases Damage against Elites by VVV%","demon-damage":"+VVV% Damage to Demons","chance-bleed":"VVV% chance to inflict Bleed for VVV damage over 5 seconds","chance-blind":"VVV% chance to Blind on Hit","chance-chill":"VVV% chance to Chill on Hit","chance-fear":"VVV% chance to Fear on Hit","chance-freeze":"VVV% chance to Freeze on Hit","chance-immobilize":"VVV% chance to Immobilize on Hit","chance-knockback":"VVV% chance to Knockback on Hit","chance-slow":"VVV% chance to Slow on Hit","chance-stun":"VVV% chance to Stun on Hit","plus-movement":"+VVV% Movement Speed","plus-pickup-radius":"Increases Gold and Health pickup by VVV yards","plus-experience":"Monster kills grant +VVV experience","plus-gold-find":"+VVV% Extra Gold from Monsters","plus-magic-find":"VVV% Better Chance of finding Magic Items","health-globes":"Health Globes grant +VVV Life","level-reduce":"Level Requirement reduced by VVV",indestructable:"Ignores durability loss","fury-max":"+VVV Maximum Fury","fury-spent-life":"Gain VVV Life per Fury Spent","bb-bash":"Increases bash damage by VVV%","bb-cleave":"Increases cleave damage by VVV%","bb-frenzy":"Increases frenzy damage by VVV%","bb-rend":"Reduces resource cost of Rend by VVV Fury","bb-revenge":"Increases Critical Hit Chance of Revenge by VVV%","bb-weapon-throw":"Reduces resource cost of Weapon Throw by VVV Fury","bb-hammer-of-the-ancients":"Reduces resource cost of Hammer of the Ancients by VVV Fury","bb-whirlwind":"Increases Critical Hit Chance of Whirlwind by VVV%","bb-overpower":"Increases Critical Hit Chance of Overpower by VVV%","bb-seismic-slam":"Increases Critical Hit Chance of Seismic Slam by VVV%","hatred-regen":"Increases Hatred Regeneration by VVV per Second","max-discipline":"+VVV Maximum Discipline","discipline-regen":"Increases Discipline Regeneration by VVV per Second","dh-cluster-arrow":"Reduces resource cost of Cluster Arrow by VVV Hatred.","dh-chakram":"Reduces resource cost of Chakram by VVV Hatred","dh-evasive-fire":"Increases Evasive Fire damage by VVV%","dh-grenades":"Increases Grenades Damage by [V]%","dh-impale":"Reduces resource cost of Impale by VVV Hatred","dh-spike-trap":"Increases Spike Trap damage by VVV%","dh-bola-shot":"Increases Bola Shot damage by VVV%","dh-elemental-arrow":"Increases Elemental Arrow damage by VVV%","dh-entangling-shot":"Increases Entangling Shot damage by VVV%","dh-hungering-arrow":"Increases Hungering Arrow damage by VVV%","dh-multishot":"Increases Critical Hit Chance of Multishot by VVV%","dh-rapid-fire":"Increases Critical Hit Chance of Rapid Fire by VVV%","spirit-spent-life":"Gain VVV per Spirit Spent","spirit-regen":"Increases Spirit Regeneration by VVV per Second","mk-crippling-wave":"Increases Crippling Wave damage by VVV%","mk-cyclone-strike":"Reduces resource cost of Cyclone Strike by VVV Spirit","mk-deadly-reach":"Increases Deadly Reach damage by VVV%","mk-exploding-palm":"Increases Exploding Palm damage by VVV%","mk-fists-of-thunder":"Increases Fist of Thunder damage by VVV%","mk-sweeping-wind":"Increases Sweeping Wind damage by VVV%","mk-way-of-the-hundred-fists":"Increases Way of the Hundred Fists damage by VVV%","mk-lashing-tail-kick":"Reduces resource cost of Lashing Tail Kick by VVV Spirit","mk-tempest-rush":"Increases Critical Hit Chance of Tempest Rush by VVV%","mk-wave-of-light":"Increases Critical Hit Chance of Wave of Light by VVV%","mana-regen":"Increases Mana Regeneration by VVV per Second","mana-max":"+VVV Maximum Mana","mana-kill":"Grants VVV Mana per Kill","wd-firebomb":"Reduces resource cost of Firebomb by VVV Mana","wd-haunt":"Increases Haunt Damage by VVV%","wd-acid-clouds":"Increases Critical Hit Chance of Acid Clouds by VVV%","wd-firebats":"Reduces resource cost of Firebats by VVV Mana","wd-zombie-dogs":"Reduces cooldown of Summon Zombie Dogs by VVV Seconds","wd-plague-of-toads":"Increases Plague of Toads damage by VVV%","wd-poison-darts":"Increaeses Poison Darts damage by VVV%","wd-spirit-barrage":"Increases Spirit Barrage damage by VVV%","wd-wall-of-zombies":"Reduces cooldown of Wall of Zombies by VVV Seconds","wd-zombie-charger":"Reduces resource cost of Zombie Charger by VVV Mana","ap-on-crit":"Critical Hits grant VVV Arcane Power","ap-max":"+VVV Maximum Arcane Power","wz-arcane-torrent":"Reduces resource cost of Arcane Torrent by VVV Arcane Power","wz-disintegrate":"Reduces resource cost of Disintegrate by VVV Arcane Power","wz-electrocute":"Increases Electrocute damage by VVV%","wz-explosive-blast":"Increases Critical Hit Chance of Explosive Blast by VVV%","wz-hydra":"Reduces resource cost of Hydra by VVV Arcane Power","wz-ray-of-frost":"Increases Critical Hit Chance of Ray of Frost by VVV%","wz-energy-twister":"Increases Critical Hit Chance of Energy Twister by VVV%","wz-magic-missle":"Increases Magic Missle damage by VVV%","wz-arcane-orb":"Increases Critical Hit Chance of Arcane Orb by VVV%","wz-blizzard":"Increases duration of Blizzard by VVV Seconds","wz-meteor":"Reduces resource cost of Meteor by VVV Arcane Power","wz-shock-pulse":"Increases Shock Pulse damage by VVV%","wz-spectral-blade":"Increases Spectral Blade damage by VVV%"},setNameInput:function(e){this.nameInput=e},bindNameInput:function(){var e=this.nameInput,t=this;e&&e.bind("keyup",function(){t.item.name=$(this).val(),t.updatePreview()})},setSocketSelect:function(e){this.socketSelect=e},bindSocketSelect:function(){var e=this.socketSelect,t=this;e&&e.bind("change",function(){t.item.socketCount=$(this).val(),t.updatePreview()})},setQualitySelect:function(e){this.qualitySelect=e},bindQualitySelect:function(){var e=this.qualitySelect,t=this;e&&e.bind("change",function(){t.item.quality=$(this).val(),t.item.quality==7?t.addSetBonusSelect():t.removeSetBonusSelect(),t.updatePreview()})},removeSetBonusSelect:function(){$("dt#setBonus-label").remove(),$("dd#setBonus-element").remove(),this.item.setBonus=null,this.preview.setBonus.empty()},addSetBonusSelect:function(){var e=this,t=$("<dt id='setBonus-label'>"),n=$("<dd id='setBonus-element'>"),r=$("<select id='setBonus' name='setBonus'>");t.html("Which set is this a part of?"),r.append("<option value=''>Select a Set</option>"),_.each(setBonuses,function(e,t){var n=$("<option>");n.val(t),n.html(e.name),this.item.setBonus&&this.item.setBonus==t&&n.attr("selected","selected"),r.append(n)},this),r.bind("change",function(){e.item.setBonus=$(this).val(),e.updatePreview()}),n.html(r),this.qualitySelect.parent().after(t,n)},setItemTypeSelect:function(e){this.itemTypeSelect=e},bindItemTypeSelect:function(){var e=this.itemTypeSelect,t=this;e.bind("change",function(){t.item.type=$(this).val(),t.item.typeName=$(this).find(":selected").text(),_.each(t.itemClass,function(e,n){_.indexOf(e,$(this).val())>=0&&(t.item.class=n,t.initPreview(),t.updatePreview())},this)})},setAttributeSelect:function(e){this.attributeSelect=e},bindAttributeSelect:function(){var e=this.attributeSelect,t=this;e.bind("change",function(){var n=e.val();_.each(n,function(e){t.addAttribute(e)},t),_.each(t.attrsSelected,function(e){_.indexOf(n,e)<0&&t.removeAttribute(e)}),t.attrsSelected=n,t.updatePreview()})},setItemPreview:function(e){this.itemPreview=e},addStat:function(e){this.item.stats[e]||(this.item.stats[e]=0)},updateStat:function(e,t){this.item.stats[e]=parseFloat(t)},removeStat:function(e){delete this.item.stats[e]},removeStats:function(e){this.item.stats={}},addAttribute:function(e){this.item.attrs[e]||(this.item.attrs[e]=0)},updateAttribute:function(e,t){this.item.attrs[e]=parseFloat(t)},removeAttribute:function(e){delete this.item.attrs[e]},removeAttributes:function(e){this.item.attrs={}},initPreview:function(){var e=this.itemPreview;this.preview.header=$("<div class='top'><p></p></div>"),this.preview.body=$("<div class='item'>"),this.preview.itemMeta=$("<p class='item-type'>"),this.preview.itemQuality=$("<span class='quality'>"),this.preview.itemType=$("<span class='type'>"),this.preview.statsPrimary=$("<p class='stats stats-primary'>"),this.preview.statsPrimaryValue=$("<span class='big-stat'>"),this.preview.statsPrimaryHelper=$("<span class='stat-helper'>"),this.preview.statsRange=$("<p class='stats stats-extra-range'>"),this.preview.statsRangeValue=$("<span>"),this.preview.statsRangeHelper=$("<span class='stat-helper'>"),this.preview.statsPercent=$("<p class='stats stats-extra-percent'>"),this.preview.statsPercentValue=$("<span>"),this.preview.statsPercentHelper=$("<span class='stat-helper'>"),this.preview.attrs=$("<ul class='attrs'>"),this.preview.sockets=$("<ul class='sockets'>"),this.preview.setBonus=$("<div class='setBonus'>"),this.preview.footer=$("<div class='bottom'>"),_.each(this.headerElements,function(e){this.preview.header.append(e)},this),_.each(this.footerElements,function(e){this.preview.footer.append(e)},this),this.itemPreview.empty().append(this.preview.header,this.preview.body.append(this.preview.itemMeta.append(this.preview.itemQuality," ",this.preview.itemType),this.preview.statsPrimary,this.preview.statsRange,this.preview.statsPercent,this.preview.attrs,this.preview.sockets,this.preview.setBonus),this.preview.footer)},updatePreview:function(){var e=this;this.preview.header.find("p").html(this.item.name),this.item.quality&&(this.preview.header.removeClass("quality-1 quality-2 quality-3 quality-4 quality-5 quality-6 quality-7"),this.preview.header.addClass("quality-"+this.item.quality),this.preview.itemMeta.removeClass("quality-1 quality-2 quality-3 quality-4 quality-5 quality-6 quality-7"),this.preview.itemMeta.addClass("quality-"+this.item.quality),this.preview.itemQuality.html(e.qualityMap[this.item.quality]),this.preview.setBonus.removeClass("quality-1 quality-2 quality-3 quality-4 quality-5 quality-6 quality-7"),this.preview.setBonus.addClass("quality-"+this.item.quality)),this.item.type&&(this.item.typeName=this.itemTypeSelect.find(":selected").text(),this.preview.itemType.html(this.item.typeName)),this.item.socketCount==0&&this.preview.sockets.empty();if(this.item.setBonus){this.preview.setBonus.empty();var t=this.getBonusHtml(this.item.setBonus);this.preview.setBonus.append(t.name,t.list)}for(i=0;i<this.item.socketCount;i++)if(!this.preview.sockets.find("#socket"+i).length){var n=$("<select name='socket"+i+"' id='socket"+i+"' tabindex='150'>");n.append($("<option value=''>Empty</option>")),_.each(gems,function(e,t){var r=$("<option>"),s=3;_.indexOf(["spirit-stone","wizard-hat","helm","voodoo-mask"],this.item.type)>=0&&(s=1),this.item.class=="weapon"&&(s=2),r.val(t),r.html(e[0]+" ("+e[s]+")"),this.item.sockets&&this.item.sockets[i]&&this.item.sockets[i]==t&&r.attr("selected","selected"),n.append(r)},this),this.preview.sockets.append($("<li>").append(n))}_.each(this.item.attrs,function(t,n){if(!this.preview.attrs.find("input[name="+n+"]").length){var r=$("<span>"),i="<input type='text' value='"+t+"' name='"+n+"' tabindex='100'>",s=e.skillText[n];s=s.replace(/VVV/,i),r.append(s),_.indexOf(["minmax-damage","arcane-damage","cold-damage","fire-damage","holy-damage","lightning-damage","poison-damage"],n)>=0&&(t==0?r.find("input").val("0-0").addClass("minmax"):r.find("input").val(t.min+"-"+t.max).addClass("minmax")),r.find("input").keyup(function(){e.updateAttribute($(this).attr("name"),$(this).val())}),e.preview.attrs.append($("<li id='input-"+n+"'>").html(r))}},this);switch(e.item.class){case"none":e.preview.statsPrimary.empty(),e.preview.statsRange.empty(),e.preview.statsPercent.empty();break;case"armor":if(!e.preview.statsPrimary.find("input[name=stat_armor]").length||e.preview.statsPercent.find("input[name=block-chance]").length){var r=$("<input name='stat_armor' tabindex='50'>");e.item.stats.armor&&r.val(e.item.stats.armor),r.keyup(function(){e.updateStat("armor",$(this).val())}),e.preview.statsPrimaryValue.empty().append(r),e.preview.statsPrimaryHelper.html("Armor"),e.preview.statsPrimary.empty().append(this.preview.statsPrimaryValue,this.preview.statsPrimaryHelper),e.preview.statsRange.empty(),e.preview.statsPercent.empty()}break;case"weapon":if(!e.preview.statsPrimary.find("input[name=stat_dps]").length){var s=$("<input name='stat_dps' tabindex='50'>"),o=$("<input name='stat_damage-min' tabindex='50'>"),u=$("<input name='stat_damage-max' tabindex='50'>"),a=$("<input name='stat_speed' tabindex='50'>");e.item.stats.dps&&s.val(e.item.stats.dps),e.item.stats.damage&&e.item.stats.damage.min&&o.val(e.item.stats.damage.min),e.item.stats.damage&&e.item.stats.damage.max&&u.val(e.item.stats.damage.max),e.item.stats.speed&&a.val(e.item.stats.speed),s.keyup(function(){e.updateStat("dps",$(this).val())}),o.keyup(function(){e.updateStat("damage-min",$(this).val())}),u.keyup(function(){e.updateStat("damage-max",$(this).val())}),a.keyup(function(){e.updateStat("speed",$(this).val())}),e.preview.statsPrimaryValue.empty().append(s),e.preview.statsPrimaryHelper.html("DPS"),e.preview.statsPrimary.empty().append(this.preview.statsPrimaryValue,this.preview.statsPrimaryHelper),e.preview.statsRangeValue.empty().append(o,"-",u),e.preview.statsRangeHelper.html("Damage"),e.preview.statsRange.empty().append(this.preview.statsRangeValue,this.preview.statsRangeHelper),e.preview.statsPercentValue.empty().append(a),e.preview.statsPercentHelper.html("Attacks per Second"),e.preview.statsPercent.empty().append(this.preview.statsPercentValue,this.preview.statsPercentHelper)}break;case"shield":if(!e.preview.statsPercent.find("input[name=stat_block-chance]").length){var r=$("<input name='stat_armor' tabindex='50'>"),o=$("<input name='stat_block-min' tabindex='50'>"),u=$("<input name='stat_block-max' tabindex='50'>"),f=$("<input name='stat_block-chance' tabindex='50'>");r.keyup(function(){e.updateStat("armor",$(this).val())}),o.keyup(function(){e.updateStat("block-min",$(this).val())}),u.keyup(function(){e.updateStat("block-max",$(this).val())}),f.keyup(function(){e.updateStat("block-chance",$(this).val())}),e.preview.statsPrimaryValue.empty().append(r),e.preview.statsPrimaryHelper.html("Armor"),e.preview.statsPrimary.empty().append(this.preview.statsPrimaryValue,this.preview.statsPrimaryHelper),e.preview.statsRangeValue.empty().append(o,"-",u),e.preview.statsRangeHelper.html("Block Value"),e.preview.statsRange.empty().append(this.preview.statsRangeValue,this.preview.statsRangeHelper),e.preview.statsPercentValue.empty().append(f),e.preview.statsPercentHelper.html("Block Chance"),e.preview.statsPercent.empty().append(this.preview.statsPercentValue,this.preview.statsPercentHelper)}}this.preview.attrs.find("li").each(function(){var t=$(this).find("input").attr("name").replace("-max","").replace("-min","");_.indexOf(e.attrsSelected,t)<0&&$(this).remove()})},init:function(){this.bindNameInput(),this.bindQualitySelect(),this.bindItemTypeSelect(),this.bindAttributeSelect(),this.bindSocketSelect(),this.initPreview()},addHeader:function(e){this.headerElements.push(e),this.preview.header.append(e)},addFooter:function(e){this.footerElements.push(e),this.preview.footer.append(e)},setItem:function(e){this.item=e,e.sockets&&(this.item.socketCount=e.sockets.length),this.item.setBonus=e.set,this.qualitySelect.trigger("change"),this.itemTypeSelect.trigger("change"),this.attributeSelect.trigger("change"),this.updatePreview()},getItem:function(){return this.item},getBonusHtml:function(e){var t=$("<ul class='bonuses'>"),n=setBonuses[e];return n.effect&&_.each(n.effect,function(e,n){if(n){var r=$("<div class='data-count'>"),i=$("<p>").html("("+n+") Set:");amountBonus=$("<ul class='amountBonus'>"),r.attr("data-count",n),_.each(e,function(e,t){var n=$("<li>"),r=this.skillText[t];r&&(e<=1?r=r.replace(/VVV/,Math.round(e*100*100)/100):r=r.replace(/VVV/,e),n.html(r),amountBonus.append(n))},this),r.append(i,amountBonus),t.append(r)}},this),{name:$("<p class='bonusName'>").html(n.name),list:t}}}