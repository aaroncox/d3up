Object.keys||(Object.keys=function(e){var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),$(function(){function t(t,n,r,i){e[t]=n;switch(r){case"per":n+="%";break;default:}var s="";s=t.replace(/\s+/g,"-").toLowerCase();var o=$("<li/>").addClass("stat-"+s).html($("<span class='stat-helper'/>").html(t+": ")).append(n);return i&&o.append(" ("+i+"%)"),o}function n(e){var n=[],r=[],i=[],s=$("#stats-offense"),o=$("#stats-defense"),u=$("#stats-base"),a=$("#stats-life"),f=$("#stats-misc"),l=$("#character").data("class"),c=!1;$(".equipped a").each(function(){if($(this).attr("data-json")){var e=$(this).data("json"),t=$(this).parent().data("slot");e.attrs&&$.each(e.attrs,function(t,n){switch(t){case"armor":if(e.type=="ring"||e.type=="amulet")r[t]?r[t]+=parseFloat(n):r[t]=parseFloat(n);break;case"max-damage":case"min-damage":switch(e.type){case"shield":case"belt":case"boots":case"bracers":case"chest-armor":case"cloak":case"gloves":case"helm":case"pants":case"mighty-belt":case"shoulder":case"spirit-stone":case"voodoo-mask":case"wizard-hat":case"ring":case"amulet":case"quiver":case"mojo":case"source":r[t]?r[t]+=parseFloat(n):r[t]=parseFloat(n);break;default:}break;case"attack-speed":switch(e.type){case"shield":case"belt":case"boots":case"bracers":case"chest-armor":case"cloak":case"gloves":case"helm":case"pants":case"mighty-belt":case"shoulder":case"spirit-stone":case"voodoo-mask":case"wizard-hat":case"ring":case"amulet":case"quiver":case"mojo":case"source":i.push(n/100);break;default:}break;default:r[t]?r[t]+=parseFloat(n):r[t]=parseFloat(n)}}),e.socketAttrs&&$.each(e.socketAttrs,function(e,t){r[e]?r[e]+=parseFloat(t):r[e]=parseFloat(t)}),e.stats&&$.each(e.stats,function(e,r){switch(e){case"speed":t=="mainhand"&&(n[e]=parseFloat(r)),t=="offhand"&&(c=!0,n["speed-oh"]=parseFloat(r));break;case"damage":t=="mainhand"&&(n[e]={min:r.min,max:r.max}),t=="offhand"&&(n["damage-oh"]={min:r.min,max:r.max});break;case"block-amount":n[e]=r.min+"-"+r.max;break;default:n[e]?n[e]+=parseFloat(r):n[e]=parseFloat(r)}})}}),u.empty();var h=0;r.dexterity||(r.dexterity=0),r.vitality||(r.vitality=0),r.strength||(r.strength=0),r.intelligence||(r.intelligence=0);switch(l){case"wizard":case"witch-doctor":r.strength+=67,r.dexterity+=67,r.intelligence+=187,h=r.intelligence;break;case"barbarian":r.strength+=187,r.dexterity+=67,r.intelligence+=67,h=r.strength;break;case"demon-hunter":case"monk":r.strength+=67,r.dexterity+=187,r.intelligence+=67,h=r.dexterity}r.vitality+=127,u.append(t("Strength",r.strength)),u.append(t("Dexterity",r.dexterity)),u.append(t("Intelligence",r.intelligence)),u.append(t("Vitality",r.vitality));var p=276+35*r.vitality,d=r["plus-life"]?r["plus-life"]:0,v=Math.round(p+p*d*.01);a.empty(),a.append(t("Maximum Life",v)),a.append(t("Total Life Bonus",d,"per")),a.append(t("Life per Second",r["life-regen"]?r["life-regen"]:0)),a.append(t("Life Steal",r["life-steal"]?r["life-steal"]:0,"per")),a.append(t("Life per Kill",r["life-kill"]?r["life-kill"]:0)),a.append(t("Life per Hit",r["life-hit"]?r["life-hit"]:0)),a.append(t("Health Globe Healing Bonus",r["health-globes"]?r["health-globes"]:0)),a.append(t("Bonus to Gold/Globe Radius",r["plus-pickup-radius"]?r["plus-pickup-radius"]:0)),o.empty();var m=n.armor+r.strength+(r.armor?r.armor:0),g=m/(3e3+m),y=Math.round(r["resist-all"]+r.intelligence/10),b={physical:y+(r["physical-resist"]?r["physical-resist"]:0),cold:y+(r["cold-resist"]?r["cold-resist"]:0),fire:y+(r["fire-resist"]?r["fire-resist"]:0),lightning:y+(r["lightning-resist"]?r["lightning-resist"]:0),poison:y+(r["poison-resist"]?r["poison-resist"]:0),arcane:y+(r["arcane-resist"]?r["arcane-resist"]:0)},w={physical:Math.round(b.physical/(300+b.physical)*100*100)/100,cold:Math.round(b.cold/(300+b.cold)*100*100)/100,fire:Math.round(b.fire/(300+b.fire)*100*100)/100,lightning:Math.round(b.lightning/(300+b.lightning)*100*100)/100,poison:Math.round(b.poison/(300+b.poison)*100*100)/100,arcane:Math.round(b.arcane/(300+b.arcane)*100*100)/100};o.append(t("Armor",m)),o.append(t("Block Amount",n["block-amount"]?n["block-amount"]:"~")),o.append(t("Block Chance",n["block-chance"]?n["block-chance"]:0,"per"));var E=r.dexterity,S=0,x=[[100,.1],[500,.025],[1e3,.02],[8e3,.01]];E>0&&$.each(x,function(e,t){E>t[0]?(E-=t[0],S+=t[0]*t[1]):(S+=E*t[1],E=0)}),o.append(t("Dodge Chance",Math.round(S*10)/10,"per")),o.append(t("Damage Reduction",Math.round(g*100*100)/100,"per")),o.append(t("Physical Resistance",b.physical,"",w.physical)),o.append(t("Cold Resistance",b.cold,"",w.cold)),o.append(t("Fire Resistance",b.fire,"",w.fire)),o.append(t("Lightning Resistance",b.lightning,"",w.lightning)),o.append(t("Poison Resistance",b.poison,"",w.poison)),o.append(t("Arcane/Holy Resistance",b.arcane,"",w.arcane)),o.append(t("Crowd Control Reduction",r["cc-reduce"]?r["cc-reduce"]:0,"per")),o.append(t("Missile Damage Reduction",r["range-reduce"]?r["range-reduce"]:0,"per")),o.append(t("Melee Damage Reduction",r["melee-reduce"]?r["melee-reduce"]:0,"per")),o.append(t("Thorns",r.thorns)),s.empty();var T=n.speed,N=1,C=n.damage,k=n.dps,L=0,A=0,O=5+(r["critical-hit"]?r["critical-hit"]:0),M=50+(r["critical-hit-damage"]?r["critical-hit-damage"]:0);if(r["max-damage"]||r["min-damage"])L=((r["max-damage"]?r["max-damage"]:0)+(r["min-damage"]?r["min-damage"]:0))/2;$.each(i,function(e,t){N+=t}),T=Math.round(T*N*100)/100;var _=k*T*(r.intelligence/100),D=_*1.74*.325;if(C)if(c){var P=n["damage-oh"],H=(C.min+C.max)/2,B=(P.min+P.max)/2,j=L,F=N,I=n.speed,q=n["speed-oh"],R=O/100*(M/100)+1,A=Math.round((H+B+j*2)*((I+q)*(F+.15)/4)*R*(h/100)*100)/100;T=Math.round(T*1.15*100)/100}else A=((C.min+C.max)/2+L)*n.speed*N*(h/100+1)*1*(O/100*(M/100)+1),A=Math.round(A*100)/100;s.append(t("DPS",A)),s.append(t("Attacks per Second",T)),s.append(t("Critical Hit Chance",O,"per")),s.append(t("Critical Hit Damage",M,"per"))}function i(t,r){var i=$("#compared-slot").find(":selected").val(),s=e;itemDisplay=$("#equipped-"+i);var o=$("<a/>"),u=itemDisplay.html();o.attr("href","/i/"+r.id),o.attr("data-json",JSON.stringify(r)),o.addClass("quality-"+r.quality),o.html(r.name),o.bindTooltip(),itemDisplay.html(o),n();var a={};jQuery.extend(a,e),itemDisplay.html(u),n();var f=$("<div/>").append($("<div/>").append("Old Item: ",u),$("<div/>").append("New Item: ",o)),l=$.diff(t,a),c=$("<table/>");header=$("<tr/>").append("<th>Stat</th><th>Old</th><th>New</th><th>Diff</th>"),c.append(header),Object.keys(l.mod).length>0?($.each(l.mod,function(e,n){var r=Math.round((a[e]-t[e])*100)/100,i=$("<tr/>");i.append($("<td/>").html(e)),r>0?(i.append($("<td class='neg'/>").html(t[e])),i.append($("<td class='pos'/>").html(a[e])),i.append($("<td/>").html(r).addClass("pos"))):(i.append($("<td class='pos'/>").html(t[e])),i.append($("<td class='neg'/>").html(a[e])),i.append($("<td/>").html(r).addClass("neg"))),c.append(i)}),c.append("<tr><td colspan='10'><span class='pos'>Green = Increase</span> / <span class='neg'>Red = Decrease</span></td></tr>")):c.append("<tr><td colspan='10' style='text-align: center; font-weight: bold;'>These items are identical.</td></tr>"),f.find("div a").each(function(){$(this).bindTooltip()}),$(".compare-diff").empty().append(f,c)}var e=[];$(".gear-change").click(function(){var e=$(this).data("item-type"),t=$("#equipped-"+e);$.ajax({url:"/item/fetch/type/"+e,cache:!1,dataType:"json",success:function(r){var i=$("#available-gear"),s=$("#gear-change");i.html(""),i.append("<option value=''>Nothing</option>"),$.each(r,function(e,t){var n=$.parseJSON(t),r=$("<option/>");r.attr("value",e),r.attr("data-json",t),r.html(n.name),r.bindTooltip(),i.append(r)}),s.dialog({width:800,modal:!0,buttons:{Equip:function(){var r=$(this);$.ajax({data:{a:"equip",slot:e,newItem:i.val()},success:function(e){if(i.val()!=""){var s=$("<a/>"),o=i.find(":selected"),u=$.parseJSON(o.attr("data-json"));s.attr("href","/i/"+i.val()),s.attr("data-json",JSON.stringify(u)),s.addClass("quality-"+u.quality),s.html(u.name),s.bindTooltip(),t.html(s)}else t.html("Nothing");r.dialog("close"),n()}})},Cancel:function(){$(this).dialog("close")}}})}})}),n(),$("#character").tabs();var r=$("#compare-to");$("#compared-slot").bind("change",function(){var e=$(this).val();$.ajax({url:"/item/fetch/type/"+e,cache:!1,dataType:"json",success:function(e){r.html(""),r.append("<option value=''>Nothing</option>"),$.each(e,function(e,t){var n=$.parseJSON(t),i=$("<option/>");i.attr("value",e),i.attr("data-json",t),i.html(n.name),i.bindTooltip(),r.append(i)})}})}),r.bind("change",function(){var t={};jQuery.extend(t,e);var n=$("#compared-slot").find(":selected").val(),r=$("#equipped-"+n+" a").data("json"),s=$(this).find(":selected").data("json"),o=i(t,s)})})