$(function(){function e(e,t){return $("<li/>").html($("<span class='stat-helper'/>").html(e+": ")).append(t)}function t(){var t=[],n=[],r=[],i=$("#stats-offense"),s=$("#stats-defense"),o=$("#stats-base"),u=$("#stats-life"),a=$("#stats-misc"),f=$("#character").data("class");$(".equipped a").each(function(){if($(this).attr("data-json")){var e=$(this).data("json");e.attrs&&$.each(e.attrs,function(t,i){switch(t){case"armor":if(e.type=="ring"||e.type=="amulet")n[t]?n[t]+=parseFloat(i):n[t]=parseFloat(i);break;case"attack-speed":switch(e.type){case"shield":case"belt":case"boots":case"bracers":case"chest-armor":case"cloak":case"gloves":case"helm":case"pants":case"mighty-belt":case"shoulder":case"spirit-stone":case"voodoo-mask":case"wizard-hat":case"ring":case"amulet":r.push(i/100);break;default:}break;default:n[t]?n[t]+=parseFloat(i):n[t]=parseFloat(i)}}),e.socketAttrs&&$.each(e.socketAttrs,function(e,t){n[e]?n[e]+=parseFloat(t):n[e]=parseFloat(t)}),e.stats&&$.each(e.stats,function(e,n){switch(e){case"damage":t[e]={min:n.min,max:n.max};break;case"block-amount":t[e]=n.min+"-"+n.max;break;default:t[e]?t[e]+=parseFloat(n):t[e]=parseFloat(n)}})}}),o.empty();var l=0;switch(f){case"wizard":case"witch-doctor":n.strength+=67,n.dexterity+=67,n.intelligence+=187,l=n.intelligence;break;case"barbarian":n.strength+=187,n.dexterity+=67,n.intelligence+=67,l=n.strength;break;case"demon-hunter":case"monk":n.strength+=67,n.dexterity+=187,n.intelligence+=67,l=n.dexterity}n.vitality+=127,o.append(e("Strength",n.strength)),o.append(e("Dexterity",n.dexterity)),o.append(e("Intelligence",n.intelligence)),o.append(e("Vitality",n.vitality));var c=276+35*n.vitality,h=n["plus-life"]?n["plus-life"]:0,p=Math.round(c+c*h*.01);u.empty(),u.append(e("Maximum Life",p)),u.append(e("Total Life Bonus",h+"%")),u.append(e("Life per Second",n["life-regen"]?n["life-regen"]:0)),u.append(e("Life Steal",n["life-steal"]?n["life-steal"]:"0%")),u.append(e("Life per Kill",n["life-kill"]?n["life-kill"]:0)),u.append(e("Life per Hit",n["life-hit"]?n["life-hit"]:0)),u.append(e("Health Globe Healing Bonus",n["health-globes"]?n["health-globes"]:0)),u.append(e("Bonus to Gold/Globe Radius",n["plus-pickup-radius"]?n["plus-pickup-radius"]:0)),s.empty();var d=t.armor+n.strength+(n.armor?n.armor:0),v=d/(3e3+d),m=Math.round(n["resist-all"]+n.intelligence/10),g={physical:m+(n["physical-resist"]?n["physical-resist"]:0),cold:m+(n["cold-resist"]?n["cold-resist"]:0),fire:m+(n["fire-resist"]?n["fire-resist"]:0),lightning:m+(n["lightning-resist"]?n["lightning-resist"]:0),poison:m+(n["poison-resist"]?n["poison-resist"]:0),arcane:m+(n["arcane-resist"]?n["arcane-resist"]:0)},y={physical:Math.round(g.physical/(300+g.physical)*100*100)/100,cold:Math.round(g.cold/(300+g.cold)*100*100)/100,fire:Math.round(g.fire/(300+g.fire)*100*100)/100,lightning:Math.round(g.lightning/(300+g.lightning)*100*100)/100,poison:Math.round(g.poison/(300+g.poison)*100*100)/100,arcane:Math.round(g.arcane/(300+g.arcane)*100*100)/100};s.append(e("Armor",d)),s.append(e("Block Amount",t["block-amount"]?t["block-amount"]:"~")),s.append(e("Block Chance",t["block-chance"]?t["block-chance"]:"0%"));var b=n.dexterity,w=0,E=[[100,.1],[500,.025],[1e3,.02],[8e3,.01]];b>0&&$.each(E,function(e,t){b>t[0]?(b-=t[0],w+=t[0]*t[1]):(w+=b*t[1],b=0)}),s.append(e("Dodge Chance",Math.round(w*10)/10)),s.append(e("Damage Reduction",Math.round(v*100*100)/100)),s.append(e("Physical Resistance",g.physical+" ("+y.physical+"%)")),s.append(e("Cold Resistance",g.cold+" ("+y.cold+"%)")),s.append(e("Fire Resistance",g.fire+" ("+y.fire+"%)")),s.append(e("Lightning Resistance",g.lightning+" ("+y.lightning+"%)")),s.append(e("Poison Resistance",g.poison+" ("+y.poison+"%)")),s.append(e("Arcane/Holy Resistance",g.arcane+" ("+y.arcane+"%)")),s.append(e("Crowd Control Reduction",n["cc-reduce"]+"%")),s.append(e("Missile Damage Reduction",n["range-reduce"]+"%")),s.append(e("Melee Damage Reduction",n["melee-reduce"]+"%")),s.append(e("Thorns",n.thorns)),i.empty();var S=t.speed,x=1,T=t.damage,N=t.dps,C=0,k=0,L=n["critical-hit"]+5,A=n["critical-hit-damage"]+50;n["max-damage"]&&n["min-damage"]&&(C=(n["max-damage"]+n["min-damage"])/2),$.each(r,function(e,t){x+=t}),S=Math.round(S*x*100)/100;var O=N*S*(n.intelligence/100),M=O*1.74*.325;T&&(k=((T.min+T.max)/2+C)*t.speed*x*(l/100+1)*1*(L/100*(A/100)+1),k=Math.round(k*100)/100,i.append("(("+T.min+"+"+T.max+")"+"/ 2 + "+C+") * "+t.speed+") * "+x+") * "+"("+l+"/ 100 + 1) * 1 * (("+L+"/ 100) * ("+A+"/100)+ 1)")),i.append(e("DPS",k)),i.append(e("Attacks per Second",S)),i.append(e("Critical Hit Chance",L+"%")),i.append(e("Critical Hit Damage",A+"%"))}$(".gear-change").click(function(){var e=$(this).data("item-type"),n=$("#equipped-"+e);$.ajax({url:"/item/fetch/type/"+e,cache:!1,dataType:"json",success:function(r){var i=$("#available-gear"),s=$("#gear-change");i.html(""),i.append("<option value=''>Nothing</option>"),$.each(r,function(e,t){var n=$.parseJSON(t),r=$("<option/>");r.attr("value",e),r.attr("data-json",t),r.html(n.name),r.bindTooltip(),i.append(r)}),s.dialog({width:800,modal:!0,buttons:{Equip:function(){var r=$(this);$.ajax({data:{a:"equip",slot:e,newItem:i.val()},success:function(e){if(i.val()!=""){var s=$("<a/>"),o=i.find(":selected"),u=$.parseJSON(o.attr("data-json"));s.attr("href","/i/"+i.val()),s.attr("data-json",JSON.stringify(u)),s.addClass("quality-"+u.quality),s.html(u.name),s.bindTooltip(),n.html(s)}else n.html("Nothing");r.dialog("close"),t()}})},Cancel:function(){$(this).dialog("close")}}})}})}),t(),$("#character").tabs()})