function statLabel(e,t,n,r){stats[e]=t;switch(n){case"per":t?t+="%":t="0%";break;case"round":t=Math.round(t*100)/100;default:}var i=e.replace(/\s+/g,"-").toLowerCase();t&&(t=t.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));var s=$("<li/>").addClass("stat-"+i).html($("<span class='stat-helper'/>").html(e+": ")).append(t);return r&&s.append(" ("+r+"%)"),s}function calc(e,t){var n=[],r=[],i=[],s=!1;heroClass||(heroClass=$(e).parent().parent().parent().data("class")),$(e).each(function(){if($(this).attr("data-json")){var e=$(this).data("json"),t=$(this).parent().data("slot");gearJSON[t]=e,e.attrs&&$.each(e.attrs,function(t,n){switch(t){case"armor":if(e.type=="ring"||e.type=="amulet")r[t]?r[t]+=parseFloat(n):r[t]=parseFloat(n);break;case"plus-block":e.type!="shield"&&(r[t]?r[t]+=parseFloat(n):r[t]=parseFloat(n));break;case"max-damage":case"min-damage":switch(e.type){case"shield":case"belt":case"boots":case"bracers":case"chest-armor":case"cloak":case"gloves":case"helm":case"pants":case"mighty-belt":case"shoulder":case"spirit-stone":case"voodoo-mask":case"wizard-hat":case"ring":case"amulet":case"quiver":case"mojo":case"source":r[t]?r[t]+=parseFloat(n):r[t]=parseFloat(n);break;default:}break;case"attack-speed":switch(e.type){case"shield":case"belt":case"boots":case"bracers":case"chest-armor":case"cloak":case"gloves":case"helm":case"pants":case"mighty-belt":case"shoulder":case"spirit-stone":case"voodoo-mask":case"wizard-hat":case"ring":case"amulet":case"quiver":case"mojo":case"source":i.push(n/100);break;default:}break;default:r[t]?r[t]+=parseFloat(n):r[t]=parseFloat(n)}}),e.socketAttrs&&$.each(e.socketAttrs,function(e,t){r[e]?r[e]+=parseFloat(t):r[e]=parseFloat(t)}),e.stats&&$.each(e.stats,function(e,r){switch(e){case"speed":t=="mainhand"&&(n[e]=parseFloat(r)),t=="offhand"&&(s=!0,n["speed-oh"]=parseFloat(r));break;case"damage":t=="mainhand"&&(n[e]={min:r.min,max:r.max}),t=="offhand"&&(n["damage-oh"]={min:r.min,max:r.max});break;case"block-amount":n[e]=r.min+"-"+r.max;break;default:n[e]?n[e]+=parseFloat(r):n[e]=parseFloat(r)}})}});var o=0;r.dexterity||(r.dexterity=0),r.vitality||(r.vitality=0),r.strength||(r.strength=0),r.intelligence||(r.intelligence=0);switch(heroClass){case"wizard":case"witch-doctor":r.strength+=67,r.dexterity+=67,r.intelligence+=187,o=r.intelligence;break;case"barbarian":r.strength+=187,r.dexterity+=67,r.intelligence+=67,o=r.strength;break;case"demon-hunter":case"monk":r.strength+=67,r.dexterity+=187,r.intelligence+=67,o=r.dexterity}r.vitality+=127;var u=276+35*r.vitality,a=r["plus-life"]?r["plus-life"]:0,f=Math.round(u+u*a*.01),l=selectVs.val()?selectVs.val():60,c=(n.armor?n.armor:0)+r.strength+(r.armor?r.armor:0),h=c/(50*l+c),p=Math.round(r["resist-all"]+r.intelligence/10),d={physical:p+(r["physical-resist"]?r["physical-resist"]:0),cold:p+(r["cold-resist"]?r["cold-resist"]:0),fire:p+(r["fire-resist"]?r["fire-resist"]:0),lightning:p+(r["lightning-resist"]?r["lightning-resist"]:0),poison:p+(r["poison-resist"]?r["poison-resist"]:0),arcane:p+(r["arcane-resist"]?r["arcane-resist"]:0)},v=Math.round(h*100*100)/100,m=r.dexterity,g=0,y=[[100,.1],[400,.025],[500,.02],[7e3,.01]],b=(n["block-chance"]?n["block-chance"]:0)+(r["plus-block"]?r["plus-block"]:0);m>0&&$.each(y,function(e,t){m>t[0]?(m-=t[0],g+=t[0]*t[1]):(g+=m*t[1],m=0)});var w=n.speed,E=0,S=n.damage,x=n.dps,T=0,N=0,C=0,k=0,L=!1,A=!1,O=5+(r["critical-hit"]?r["critical-hit"]:0),M=50+(r["critical-hit-damage"]?r["critical-hit-damage"]:0),_=!1;typeof S=="undefined"&&(S={min:0,max:0});if(!t)var t=passiveSelect.val();t&&$.each(t,function(e,t){typeof passives[heroClass][t]["effect"]!="undefined"&&$.each(passives[heroClass][t].effect,function(e,t){switch(e){case"sharpshooter":A="Sharpshooter",L=((S.min+S.max)/2+T)*n.speed*E*(o/100+1)*1*(1*(M/100)+1),L=Math.round(k*100)/100;break;case"plus-armor":c=Math.round(c*(1+t)*100)/100,h=c/(50*l+c),v=Math.round(h*100*100)/100;break;case"plus-thorns":r.thorns&&(r.thorns=r.thorns*(1+t));break;case"plus-damage":_?_+=t:_=t;break;case"flatten-resists":var i=0;$.each(d,function(e,t){t>0&&t>i&&(i=t)}),$.each(d,function(e,t){d[e]=i});break;case"plus-resist-all":p*=1+t,d.physical=d.physical*(1+t),d.cold=d.cold*(1+t),d.fire=d.fire*(1+t),d.lightning=d.lightning*(1+t),d.poison=d.poison*(1+t),d.arcane=d.arcane*(1+t);break;case"melee-reduce":case"plus-movement-speed":case"max-spirit":case"max-hatred":case"max-fury":case"life-steal":case"cc-reduce":r[e]?r[e]+=t*100:r[e]=t*100;break;case"reduce-damage":v*=1+t;break;case"health-globes":r["health-globes"]&&r["health-globes"]>0&&(r["health-globes"]=r["health-globes"]*(1+t));break;case"critical-to-dodge":g+=g*t;break;case"dexterity-to-armor":c+=r.dexterity*t,h=c/(50*l+c),v=Math.round(h*100*100)/100;break;case"vitality-to-armor":c+=r.vitality*t;break;case"critical-hit-damage":M+=t*100;break;case"plus-mana":r["max-mana"]&&(r["max-mana"]=r["max-mana"]+r["max-mana"]*t);break;case"critical-hit":O+=t*100;break;case"switch":typeof gearJSON[t.var]!="undefined"&&$.each(t.cases,function(e,n){var r=!1;$.each(n.case.split("|"),function(e,r){r==gearJSON[t.var][t.lookup]&&$.each(n.effect,function(e,t){switch(e){case"plus-damage":_?_+=t:_=t;break;case"critical-hit-damage":M+=t*100;break;case"attack-speed":w*=1+t;break;case"plus-damage":k=Math.round(k*(1+t)*100)/100;break;case"critical-hit":O+=t*100;break;default:console.log("Unhandled Switch: "+e+" ["+t+"]")}})})});break;default:console.log("Unhandled Effect: "+e+"["+t+"]")}})});if(r["max-damage"]||r["min-damage"])T=((r["max-damage"]?r["max-damage"]:0)+(r["min-damage"]?r["min-damage"]:0))/2,r["min-damage"]&&(N=r["min-damage"]),r["max-damage"]&&(C=r["max-damage"]);$.each(i,function(e,t){E+=t});var D=x*w*(r.intelligence/100),P=D*1.74*.325;if(S){if(s){var H=n["damage-oh"];E=Math.round(E*1e3)/1e3,n.speed=Math.floor(n.speed*1024)/1024,n["speed-oh"]=Math.floor(n["speed-oh"]*1024)/1024;var B=((S.min+S.max+H.min+H.max)/2+N+C)/2,j=(n.speed+n["speed-oh"])/2,F=1.15+E,I=1+o/100,q=1+O/100*(M/100),k=Math.round(B*j*F*I*q*100)/100,w=Math.round(w*(1+E+.15)*100)/100,R=(n.speed+n["speed-oh"])/2,U=1/(Math.round(n.speed*1024)/1024*(1+E))+1/(Math.round(n["speed-oh"]*1024)/1024*(1+E))}else n.speed=Math.floor(n.speed*1024)/1024,w=Math.round(w*(1+E)*100)/100,k=((S.min+S.max)/2+T)*n.speed*(1+E)*(o/100+1)*1*(O/100*(M/100)+1),k=Math.round(k*100)/100;_&&(k=Math.round(k*(1+_)*100)/100)}var z={all:Math.round(p/(5*l+p)*100*100)/100,physical:Math.round(d.physical/(5*l+d.physical)*100*100)/100,cold:Math.round(d.cold/(5*l+d.cold)*100*100)/100,fire:Math.round(d.fire/(5*l+d.fire)*100*100)/100,lightning:Math.round(d.lightning/(5*l+d.lightning)*100*100)/100,poison:Math.round(d.poison/(5*l+d.poison)*100*100)/100,arcane:Math.round(d.arcane/(5*l+d.arcane)*100*100)/100},W=v/100,X=p/(5*l+p),V=(1-X)*(1-W),J=r["melee-reduce"]?r["melee-reduce"]:0,K=r["range-reduce"]?r["range-reduce"]:0,Q=r["elite-reduce"]?r["elite-reduce"]:0,G=d.physical/(5*l+d.physical),Y=d.cold/(5*l+d.cold),Z=d.fire/(5*l+d.fire),et=d.lightning/(5*l+d.lightning),tt=d.poison/(5*l+d.poison),nt=d.arcane/(5*l+d.arcane),rt=f/((1-W)*(1-G)),it=f/((1-W)*(1-Y)),st=f/((1-W)*(1-Z)),ot=f/((1-W)*(1-et)),ut=f/((1-W)*(1-tt)),at=f/((1-W)*(1-nt));if(heroClass=="monk"||heroClass=="barbarian")V=(1-X)*(1-W)*.7,rt=f/((1-W)*(1-G)*.7),it=f/((1-W)*(1-Y)*.7),st=f/((1-W)*(1-Z)*.7),ot=f/((1-W)*(1-et)*.7),ut=f/((1-W)*(1-tt)*.7),at=f/((1-W)*(1-nt)*.7);var ft=f/V,lt=V*(1-g/100),ct=V*(1-J/100),ht=V*(1-K/100),pt=V*(1-Q/100),dt=f/lt,vt=f/ct,mt=f/ht,gt=f/pt,yt={};$(e).each(function(){var e=$(this).data("json"),t=$(this).parent().data("slot"),n={mathEHP:0,mathReduction:0,resistAll:0,armor:0,intelligence:0,vitality:127,life:0};e.stats&&e.stats.armor&&(n.armor+=e.stats.armor),e.attrs&&(e.attrs.intelligence&&(n.intelligence+=e.attrs.intelligence),e.attrs.strength&&(n.armor+=e.attrs.strength),e.attrs["resist-all"]&&(n.resistAll+=e.attrs["resist-all"]),e.attrs.vitality&&(n.vitality+=e.attrs.vitality)),e.socketAttrs&&(e.socketAttrs.vitality,e.socketAttrs.intelligence&&(n.intelligence+=e.socketAttrs.intelligence),e.socketAttrs.strength&&(n.armor+=e.socketAttrs.strength)),n.life=276+35*n.vitality,e.socketAttrs&&e.socketAttrs["plus-life"]&&(n.life=n.life*(1+e.socketAttrs["plus-life"]/100)),n.armor&&(n.mathReduction=n.armor/(50*l*n.armor)),n.mathAllResist=Math.round(n.resistAll+n.intelligence/10),n.mathAR=n.mathAllResist/(5*parseInt(l)+n.mathAllResist),n.mathDT=(1-n.mathAR)*(1-n.mathReduction),n.mathEHP=n.life/n.mathDT,yt[t]=n.mathEHP}),$("#stats-ehp-gear").html("");var bt=$("<ul class='resist-specific'/>").append($("<li class='header'/>").html("Gear Based EHP (<a href='/faq/gear-based-ehp'>?</a>)"));$.each(yt,function(e,t){t&&t>4721?bt.append(statLabel(e+" EHP",t,"round")):bt.append(statLabel(e+" EHP","~"))}),$("#stats-ehp-gear").append(bt),tabEHP.empty(),tabEHP.append(statLabel("EHP",ft,"round")),tabEHP.append(statLabel("EHP w/ Dodge",dt,"round")),tabEHP.append($("<ul class='resist-specific'/>").append($("<li class='header'/>").html("Damage Type EHP"),statLabel("Melee EHP",vt,"round"),statLabel("Ranged EHP",mt,"round"),statLabel("Elite EHP",gt,"round"))),tabEHP.append($("<ul class='resist-specific'/>").append($("<li class='header'/>").html("Elemental EHP"),statLabel("Physical EHP",rt,"round"),statLabel("Cold EHP",it,"round"),statLabel("Fire EHP",st,"round"),statLabel("Lightning EHP",ot,"round"),statLabel("Poison EHP",ut,"round"),statLabel("Arcane/Holy EHP",at,"round"))),tabBase.empty(),tabBase.append(statLabel("Strength",r.strength)),tabBase.append(statLabel("Dexterity",r.dexterity)),tabBase.append(statLabel("Intelligence",r.intelligence)),tabBase.append(statLabel("Vitality",r.vitality)),tabBase.append(statLabel("Magic Find",r["plus-magic-find"],"per")),tabBase.append(statLabel("Gold Find",r["plus-gold-find"],"per")),tabDefense.empty(),tabDefense.append(statLabel("Armor",c,"",v)),tabDefense.append(statLabel("All Resist",p,"round",z.all)),tabDefense.append(statLabel("Block Amount",n["block-amount"]?n["block-amount"]:"~")),tabDefense.append(statLabel("Block Chance",b,"per")),tabDefense.append(statLabel("Dodge Chance",Math.round(g*10)/10,"per")),tabDefense.append(statLabel("Damage Reduction",v,"per")),tabDefense.append(statLabel("Physical Resistance",d.physical,"round",z.physical)),tabDefense.append(statLabel("Cold Resistance",d.cold,"round",z.cold)),tabDefense.append(statLabel("Fire Resistance",d.fire,"round",z.fire)),tabDefense.append(statLabel("Lightning Resistance",d.lightning,"round",z.lightning)),tabDefense.append(statLabel("Poison Resistance",d.poison,"round",z.poison)),tabDefense.append(statLabel("Arcane/Holy Resistance",d.arcane,"round",z.arcane)),tabDefense.append(statLabel("Crowd Control Reduction",r["cc-reduce"]?r["cc-reduce"]:0,"per")),tabDefense.append(statLabel("Missile Damage Reduction",K,"per")),tabDefense.append(statLabel("Melee Damage Reduction",J,"per")),tabDefense.append(statLabel("Elite Damage Reduction",Q,"per")),tabDefense.append(statLabel("Thorns",r.thorns)),tabOffense.empty(),tabOffense.append(statLabel("DPS",k)),L&&tabOffense.append(statLabel("DPS w/ "+A,k)),tabOffense.append(statLabel("Attacks per Second",w)),tabOffense.append(statLabel("Critical Hit Chance",O,"per")),tabOffense.append(statLabel("Critical Hit Damage",M,"per")),tabLife.empty(),tabLife.append(statLabel("Maximum Life",f)),tabLife.append(statLabel("Total Life Bonus",a,"per")),tabLife.append(statLabel("Life per Second",r["life-regen"]?r["life-regen"]:0)),tabLife.append(statLabel("Life Steal",r["life-steal"]?r["life-steal"]:0,"per")),tabLife.append(statLabel("Life per Kill",r["life-kill"]?r["life-kill"]:0)),tabLife.append(statLabel("Life per Hit",r["life-hit"]?r["life-hit"]:0)),tabLife.append(statLabel("Health Globe Healing Bonus",r["health-globes"]?r["health-globes"]:0)),tabLife.append(statLabel("Bonus to Gold/Globe Radius",r["plus-pickup-radius"]?r["plus-pickup-radius"]:0))}function calcDiff(e,t){var n=$("#compared-slot").find(":selected").val(),r=stats;itemDisplay=$("#equipped-"+n);var i=$("<a/>"),s=itemDisplay.html(),o=!1,u=[];switch(t.type){case"2h-mace":case"2h-axe":case"diabo":case"2h-mighty":case"polearm":case"staff":case"2h-sword":$("#equipped-offhand a").length&&(o=JSON.parse($("#equipped-offhand a").attr("data-json")),$("#equipped-offhand").html(""),u.push("We notice you're comparing a two-handed weapon vs your currently equipped mainhand + off-hand items. We've adjusted the comparision slightly so you can see the actual stats between your mainhand + offhand VS the two-hander (without the offhand)."))}i.attr("href","/i/"+t.id),i.attr("data-json",JSON.stringify(t)),i.addClass("quality-"+t.quality),i.html(t.name),i.bindTooltip(),itemDisplay.html(i),calc(".equipped a");var a={};jQuery.extend(a,stats);if(o){var f=$("<a/>").attr("href","/i/"+o.id).attr("data-json",JSON.stringify(o)).addClass("quality-"+o.quality).html(o.name);f.bindTooltip(),$("#equipped-offhand").append(f)}itemDisplay.html(s),itemDisplay.find("a").bindTooltip(),calc(".equipped a"),$("#compare-notes").html(""),u.length>0&&$.each(u,function(e,t){$("#compare-notes").append(t)});var l=$("<div/>"),c=$("<div/>").append("Old Item: ",s),h=$("<div/>").append("New Item: ",i),p=$.diff(e,a),d=$("<table/>");return header=$("<tr/>").append("<th>Stat</th><th>Diff</th><th>Old</th><th>New</th>"),o&&c.append(" (+"+$("#equipped-offhand").html()+")"),l.append(c,h),d.append(header),Object.keys(p.mod).length>0?($.each(p.mod,function(t,n){var r=Math.round((a[t]-e[t])*100)/100,i=$("<tr/>");i.append($("<td/>").html(t));var s=Math.round(e[t]*100)/100,o=Math.round(a[t]*100)/100;s>99999&&(s=Math.round(s/10)/100+"k"),o>99999&&(o=Math.round(o/10)/100+"k"),r>0?(i.append($("<td/>").html("+"+r).addClass("pos")),i.append($("<td class='neg'/>").html(s)),i.append($("<td class='pos'/>").html(o))):(i.append($("<td/>").html(r).addClass("neg")),i.append($("<td class='pos'/>").html(s)),i.append($("<td class='neg'/>").html(o))),d.append(i)}),d.append("<tr><td colspan='10'><span class='pos'>Green = Increase</span> / <span class='neg'>Red = Decrease</span></td></tr>")):d.append("<tr><td colspan='10' style='text-align: center; font-weight: bold;'>These items are identical.</td></tr>"),l.find("div a").each(function(){$(this).bindTooltip()}),$(".compare-diff").empty().append(l,d),p.mod}Object.keys||(Object.keys=function(e){var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t});var stats=[],gearJSON={},tabOffense=$("#stats-offense"),tabDefense=$("#stats-defense"),tabBase=$("#stats-base"),tabLife=$("#stats-life"),tabMisc=$("#stats-misc"),tabEHP=$("#stats-ehp"),tabEHPGear="#stats-ehp-gear",selectVs=$("#vsLevel"),heroClass=$("#character").data("class"),isOwner=$("#character").data("owner"),skillDisplay=$("#skill-display"),activeSelect=$("#actives"),activeDisplay=$("#active-display"),passiveSelect=$("#passives"),passiveDisplay=$("#passive-display");activeSkills&&activeSkills[heroClass]&&$.each(window.activeSkills[heroClass],function(e,t){var n="";typeof activeActives!="undefined"&&$.each(activeActives,function(t,r){e==r&&(n='selected="selected"')}),activeSelect.append($("<option value='"+e+"' "+n+"/>").html(t.name))}),passives&&passives[heroClass]&&$.each(passives[heroClass],function(e,t){var n="";typeof activePassives!="undefined"&&$.each(activePassives,function(t,r){e==r&&(n='selected="selected"')}),passiveSelect.append($("<option value='"+e+"' "+n+"/>").html(e.replace(/\-/g," ").capitalize()))}),activeSelect.chosen({placeholder:"Which skills/abilities do you use?",allowClear:!0}),passiveSelect.chosen({placeholder:"Which passives skills are you using?",allowClear:!0}),activeSelect.bind("change",function(){var e=$(this).val()?$(this).val():[];(!e||activeActives.length!=e.length)&&isOwner&&e.length<=6&&$.ajax({data:{a:"active-skills",actives:e}}),activeDisplay.empty(),$.each(e,function(e,t){skillDisplay.show();if(e>=6)return!1;var n=activeSkills[heroClass][t],r=t.split("~"),i="/images/icons/"+heroClass+"-"+r[0]+".png";img=$("<img/>").attr("src",i),img.attr("data-name",n.name),img.attr("title",n.name),n.rune?img.attr("data-tooltip",n.desc.replace(/  /,"<br/><br/>")+"<br/><br/>"+n.rune):img.attr("data-tooltip",n.desc),activeDisplay.append($("<li/>").html(img))})}),passiveSelect.bind("change",function(){var e=$(this).val()?$(this).val():[];(!e||activePassives.length!=e.length)&&isOwner&&e.length<=3&&$.ajax({data:{a:"passive-skills",passives:e}}),passiveDisplay.empty(),$.each(e,function(e,t){skillDisplay.show();var n=passives[heroClass][t],r="/images/icons/"+heroClass+"-"+t+".png";img=$("<img/>").attr("src",r),img.attr("data-name",t.replace(/\-/g," ").capitalize()),img.attr("title",t.replace(/\-/g," ").capitalize()),img.attr("data-tooltip",n.desc),passiveDisplay.append($("<li/>").html(img))}),calc(".equipped a")}),activeSelect.trigger("change"),passiveSelect.trigger("change"),selectVs.bind("change",function(){calc(".equipped a")}),isOwner&&$(".gear-change").click(function(){var e=$(this).data("item-type"),t=$("#equipped-"+e);if(e=="offhand"){var n=$("#equipped-mainhand a").data("json");switch(n.type){case"2h-mace":case"2h-axe":case"diabo":case"2h-mighty":case"polearm":case"staff":case"2h-sword":return $($("<div style='padding: 20px'/>").html("<p>You're currently wearing a two handed weapon, an offhand isn't allowed.")).dialog({modal:!0,buttons:{Ok:function(){$(this).dialog("close")}}}),!1}}$.ajax({url:"/item/fetch/type/"+e,cache:!1,dataType:"json",success:function(n){var r=$("#available-gear"),i=$("#gear-change");r.html(""),r.append("<option value=''>Nothing</option>"),$.each(n,function(e,t){var n=$.parseJSON(t),i=$("<option/>");i.attr("value",e),i.attr("data-json",t),i.html(n.name),i.bindTooltip(),r.append(i)}),i.dialog({width:800,modal:!0,buttons:{Equip:function(){var n=$(this);$.ajax({data:{a:"equip",slot:e,newItem:r.val(),stats:{dps:stats.DPS,ehp:stats.EHP}},success:function(e){if(r.val()!=""){var i=$("<a/>"),s=r.find(":selected"),o=$.parseJSON(s.attr("data-json"));switch(o.type){case"2h-mace":case"2h-axe":case"diabo":case"2h-mighty":case"polearm":case"staff":case"2h-sword":$("#equipped-offhand").html("Nothing")}i.attr("href","/i/"+r.val()),i.attr("data-json",JSON.stringify(o)),i.addClass("quality-"+o.quality),i.html(o.name),i.bindTooltip(),t.html(i)}else t.html("Nothing");n.dialog("close"),calc(".equipped a")}})},Cancel:function(){$(this).dialog("close")}}})}})});var compareTo=$("#compare-to");$("#compared-slot").bind("change",function(){var e=$(this).val();$.ajax({url:"/item/fetch/type/"+e,cache:!1,dataType:"json",success:function(e){compareTo.html(""),compareTo.append("<option value=''>Nothing</option>"),$.each(e,function(e,t){var n=$.parseJSON(t),r=$("<option/>");r.attr("value",e),r.attr("data-json",t),r.html(n.name),r.bindTooltip(),compareTo.append(r)})}})}),compareTo.bind("change",function(){var e={};jQuery.extend(e,stats);var t=$("#compared-slot").find(":selected").val(),n=$("#equipped-"+t+" a").data("json"),r=$(this).find(":selected").data("json"),i=calcDiff(e,r)})